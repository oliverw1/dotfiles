function cl() {
    cd "$@" && \
    ls --classify --color=auto
}

# show only devices, not (virtual) file systems and network storage
function mnt() { mount | awk '$1 ~ /\/dev/ { print $1,$3; }' | column -t | sort ; }

function qh() {
    #           ┌─ enable colors for pipe
    #           │  ("--color=auto" enables colors only if
    #           │  the output is in the terminal)
    grep --color=always "$*" "$HISTFILE" |       less -RX
    # display ANSI color escape sequences in raw form ─┘│
    #       don't clear the screen after quitting less ─┘
}
function mkcd() { mkdir -p -- "$1" && cd -- "$1"; }

function gp() {
# Distinguish between the Gitpod workspace CLI (known as gp) and the gitpod cli
# for non-workspaces that allow you (ao) to start new workspaces and tunnel to them.
    if [ -n "${GITPOD_WORKSPACE_CONTEXT_URL}" ]; then 
      # go straight to the real command (builtin or on your path), do not use bash aliases or functions
      command gp "$@"
    else
      command gitpod "$@"
    fi
}


function gppf() {
# gitpod port forwarding

  local ssh_command
  local streamlit=8501
  local browser=8080
  local common_ports=($streamlit $browser)

  ssh_command=$(ps -C ssh --format cmd --no-headers | fzf --select-1)

  if [[ $? -ne 0 || -z "$ssh_command" ]]; then
    echo "No SSH tunnel selected or found."
    return 1
  fi

  for port in "${common_ports[@]}"; do
    ssh_command+=" -L ${port}:127.0.0.1:${port}"
  done

  # Add user-specified port forwarding rules if they are numeric
  for arg in "$@"; do
    if [[ "$arg" =~ ^[0-9]+$ ]]; then
      ssh_command+=" -L ${arg}:127.0.0.1:${arg}"
    else
      echo "Warning: Ignoring non-numeric argument: '$arg'" >&2
    fi
  done

  ssh_command+=" -N -f"   # no interaction & go to background
  echo "${ssh_command}"
  eval "${ssh_command}"
}

function gpstream() {
  # Open the Streamlit application running on Gitpod
  if gppf; then
    xdg-open http://localhost:8501
  else
    echo "Failed to set up SSH port forwarding."
  fi
}

